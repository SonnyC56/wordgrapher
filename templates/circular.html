<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circular Word Visualization</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .main-content {
            margin: 20px auto;
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="text-center mb-4">
            <h1>Circular Word Visualization</h1>
            <a href="index.html" class="btn btn-outline-secondary">Back to Word Grapher</a>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="mb-3">
                    <label for="text" class="form-label">Enter your text:</label>
                    <textarea class="form-control" id="text" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="colorPicker" class="form-label">Line Color:</label>
                    <input type="color" class="form-control form-control-color" id="colorPicker" value="#4BC0C0">
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <canvas id="circularGraph" width="600" height="600"></canvas>
        </div>

        <div class="text-center mt-3">
            <button onclick="downloadVisualization()" class="btn btn-success">Download Image</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('circularGraph');
        const ctx = canvas.getContext('2d');
        let animationFrame;

        function drawCircularVisualization(text) {
            const radius = 250;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!text) return;

            const uniqueChars = [...new Set(text.toLowerCase())];
            const positions = {};
            
            // Calculate positions for each unique character
            uniqueChars.forEach((char, index) => {
                const angle = (index / uniqueChars.length) * Math.PI * 2;
                positions[char] = {
                    x: centerX + radius * Math.cos(angle),
                    y: centerY + radius * Math.sin(angle)
                };
            });

            // Draw character nodes
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            Object.entries(positions).forEach(([char, pos]) => {
                // Draw circle behind character
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 15, 0, Math.PI * 2);
                ctx.fillStyle = '#f8f9fa';
                ctx.fill();
                ctx.strokeStyle = '#dee2e6';
                ctx.stroke();
                
                // Draw character
                ctx.fillStyle = '#000';
                ctx.fillText(char, pos.x, pos.y);
            });

            // Draw connections between repeated characters
            const lineColor = document.getElementById('colorPicker').value;
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 1;
            ctx.beginPath();

            for (let i = 0; i < text.length - 1; i++) {
                const char1 = text[i].toLowerCase();
                const char2 = text[i + 1].toLowerCase();
                
                if (positions[char1] && positions[char2]) {
                    const start = positions[char1];
                    const end = positions[char2];
                    
                    // Draw curved line
                    ctx.beginPath();
                    ctx.moveTo(start.x, start.y);
                    
                    // Calculate control point for curve
                    const midX = (start.x + end.x) / 2;
                    const midY = (start.y + end.y) / 2;
                    const distance = Math.sqrt(
                        Math.pow(end.x - start.x, 2) + 
                        Math.pow(end.y - start.y, 2)
                    );
                    
                    // Pull the curve toward the center more for longer distances
                    const pullToward = Math.min(0.5, distance / 1000);
                    const ctrlX = midX + (centerX - midX) * pullToward;
                    const ctrlY = midY + (centerY - midY) * pullToward;
                    
                    ctx.quadraticCurveTo(ctrlX, ctrlY, end.x, end.y);
                    ctx.stroke();
                }
            }
        }

        function downloadVisualization() {
            const link = document.createElement('a');
            link.download = 'circular_visualization.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // Add event listeners for real-time updates
        document.getElementById('text').addEventListener('input', (e) => {
            cancelAnimationFrame(animationFrame);
            animationFrame = requestAnimationFrame(() => drawCircularVisualization(e.target.value));
        });

        document.getElementById('colorPicker').addEventListener('input', (e) => {
            cancelAnimationFrame(animationFrame);
            animationFrame = requestAnimationFrame(() => 
                drawCircularVisualization(document.getElementById('text').value)
            );
        });
    </script>
</body>
</html>
